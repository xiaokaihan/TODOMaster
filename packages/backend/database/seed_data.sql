-- TODOMaster 示例数据
-- 说明：演示数据库使用方式和各表之间的关系

-- 插入测试用户
INSERT INTO users (id, email, name, password_hash, email_verified) VALUES
('550e8400-e29b-41d4-a716-446655440001', 'zhang.wei@example.com', '张伟', '$2b$10$example_hash_1', true),
('550e8400-e29b-41d4-a716-446655440002', 'li.ming@example.com', '李明', '$2b$10$example_hash_2', true),
('550e8400-e29b-41d4-a716-446655440003', 'wang.lei@example.com', '王磊', '$2b$10$example_hash_3', false);

-- 插入目标
INSERT INTO objectives (id, title, description, category, priority, status, start_date, target_date, user_id) VALUES
-- 张伟的目标
('650e8400-e29b-41d4-a716-446655440001', 
 '完成React项目重构', 
 '将现有Vue项目完全重构为React架构，提升性能和可维护性', 
 'PROFESSIONAL', 'HIGH', 'ACTIVE', 
 '2024-01-01', '2024-03-31', 
 '550e8400-e29b-41d4-a716-446655440001'),

('650e8400-e29b-41d4-a716-446655440002', 
 '健身减重计划', 
 '通过科学饮食和规律运动，在6个月内减重10公斤', 
 'HEALTH', 'MEDIUM', 'ACTIVE', 
 '2024-01-01', '2024-06-30', 
 '550e8400-e29b-41d4-a716-446655440001'),

-- 李明的目标
('650e8400-e29b-41d4-a716-446655440003', 
 '学习TypeScript高级特性', 
 '深入学习TypeScript的高级类型系统和最佳实践', 
 'LEARNING', 'MEDIUM', 'DRAFT', 
 '2024-02-01', '2024-04-30', 
 '550e8400-e29b-41d4-a716-446655440002'),

-- 王磊的目标
('650e8400-e29b-41d4-a716-446655440004', 
 '财务理财规划', 
 '建立完整的个人财务管理体系，实现财务自由', 
 'FINANCIAL', 'HIGH', 'ACTIVE', 
 '2024-01-15', '2024-12-31', 
 '550e8400-e29b-41d4-a716-446655440003');

-- 插入关键结果
INSERT INTO key_results (id, title, description, target_value, current_value, unit, type, status, due_date, objective_id) VALUES
-- React项目重构的关键结果
('750e8400-e29b-41d4-a716-446655440001', 
 '代码覆盖率达到80%', 
 '确保项目的测试覆盖率达到80%以上，保证代码质量', 
 80, 52, '%', 'PERCENTAGE', 'IN_PROGRESS', 
 '2024-03-15', '650e8400-e29b-41d4-a716-446655440001'),

('750e8400-e29b-41d4-a716-446655440002', 
 '性能提升50%', 
 '页面加载时间相比旧版本提升50%', 
 50, 30, '%', 'PERCENTAGE', 'IN_PROGRESS', 
 '2024-03-20', '650e8400-e29b-41d4-a716-446655440001'),

('750e8400-e29b-41d4-a716-446655440003', 
 '组件库完成', 
 '完成可复用组件库的开发和文档', 
 1, 0, '', 'BOOLEAN', 'NOT_STARTED', 
 '2024-02-28', '650e8400-e29b-41d4-a716-446655440001'),

-- 健身减重的关键结果
('750e8400-e29b-41d4-a716-446655440004', 
 '体重减少10公斤', 
 '从75kg减重到65kg', 
 10, 3, 'kg', 'NUMERIC', 'IN_PROGRESS', 
 '2024-06-30', '650e8400-e29b-41d4-a716-446655440002'),

('750e8400-e29b-41d4-a716-446655440005', 
 '每周运动4次', 
 '保持每周至少4次运动的频率', 
 4, 3, '次/周', 'NUMERIC', 'IN_PROGRESS', 
 NULL, '650e8400-e29b-41d4-a716-446655440002'),

-- TypeScript学习的关键结果
('750e8400-e29b-41d4-a716-446655440006', 
 '完成高级课程', 
 '完成TypeScript高级特性在线课程', 
 100, 25, '%', 'PERCENTAGE', 'IN_PROGRESS', 
 '2024-04-15', '650e8400-e29b-41d4-a716-446655440003'),

('750e8400-e29b-41d4-a716-446655440007', 
 '实践项目完成', 
 '使用TypeScript高级特性完成一个实践项目', 
 1, 0, '', 'BOOLEAN', 'NOT_STARTED', 
 '2024-04-30', '650e8400-e29b-41d4-a716-446655440003'),

-- 财务规划的关键结果
('750e8400-e29b-41d4-a716-446655440008', 
 '应急基金储备', 
 '储备6个月生活费用作为应急基金', 
 60000, 25000, '元', 'NUMERIC', 'IN_PROGRESS', 
 '2024-06-30', '650e8400-e29b-41d4-a716-446655440004'),

('750e8400-e29b-41d4-a716-446655440009', 
 '投资收益率', 
 '实现年化投资收益率8%', 
 8, 3, '%', 'PERCENTAGE', 'IN_PROGRESS', 
 '2024-12-31', '650e8400-e29b-41d4-a716-446655440004');

-- 插入任务
INSERT INTO tasks (id, title, description, priority, status, due_date, estimated_duration, tags, key_result_id, user_id) VALUES
-- 代码覆盖率相关任务
('850e8400-e29b-41d4-a716-446655440001', 
 '编写组件单元测试', 
 '为核心业务组件编写完整的单元测试用例', 
 'HIGH', 'IN_PROGRESS', 
 '2024-02-15 18:00:00+08', 480, 
 ARRAY['测试', '单元测试', 'Jest'], 
 '750e8400-e29b-41d4-a716-446655440001', 
 '550e8400-e29b-41d4-a716-446655440001'),

('850e8400-e29b-41d4-a716-446655440002', 
 '集成测试覆盖', 
 '添加关键业务流程的集成测试', 
 'MEDIUM', 'TODO', 
 '2024-02-20 18:00:00+08', 360, 
 ARRAY['测试', '集成测试'], 
 '750e8400-e29b-41d4-a716-446655440001', 
 '550e8400-e29b-41d4-a716-446655440001'),

-- 性能提升相关任务
('850e8400-e29b-41d4-a716-446655440003', 
 '优化组件渲染', 
 '使用React.memo和useMemo优化组件渲染性能', 
 'HIGH', 'COMPLETED', 
 '2024-01-25 18:00:00+08', 240, 
 ARRAY['性能优化', 'React', '前端'], 
 '750e8400-e29b-41d4-a716-446655440002', 
 '550e8400-e29b-41d4-a716-446655440001'),

('850e8400-e29b-41d4-a716-446655440004', 
 '代码分割实现', 
 '实现路由级别的代码分割，减少初始加载时间', 
 'HIGH', 'IN_PROGRESS', 
 '2024-02-10 18:00:00+08', 360, 
 ARRAY['性能优化', '代码分割', 'Webpack'], 
 '750e8400-e29b-41d4-a716-446655440002', 
 '550e8400-e29b-41d4-a716-446655440001'),

-- 组件库相关任务
('850e8400-e29b-41d4-a716-446655440005', 
 '设计组件架构', 
 '设计可复用组件库的整体架构和API设计', 
 'CRITICAL', 'COMPLETED', 
 '2024-01-20 18:00:00+08', 480, 
 ARRAY['架构设计', '组件库', 'API设计'], 
 '750e8400-e29b-41d4-a716-446655440003', 
 '550e8400-e29b-41d4-a716-446655440001'),

('850e8400-e29b-41d4-a716-446655440006', 
 '实现基础组件', 
 '实现Button、Input、Modal等基础组件', 
 'HIGH', 'IN_PROGRESS', 
 '2024-02-25 18:00:00+08', 720, 
 ARRAY['组件开发', 'UI组件', 'TypeScript'], 
 '750e8400-e29b-41d4-a716-446655440003', 
 '550e8400-e29b-41d4-a716-446655440001'),

-- 健身运动相关任务
('850e8400-e29b-41d4-a716-446655440007', 
 '制定运动计划', 
 '制定详细的每周运动计划，包括有氧和力量训练', 
 'HIGH', 'COMPLETED', 
 '2024-01-05 20:00:00+08', 120, 
 ARRAY['健身', '计划制定'], 
 '750e8400-e29b-41d4-a716-446655440005', 
 '550e8400-e29b-41d4-a716-446655440001'),

('850e8400-e29b-41d4-a716-446655440008', 
 '每周跑步3次', 
 '保持每周3次跑步，每次5公里', 
 'MEDIUM', 'IN_PROGRESS', 
 NULL, 60, 
 ARRAY['跑步', '有氧运动', '习惯'], 
 '750e8400-e29b-41d4-a716-446655440005', 
 '550e8400-e29b-41d4-a716-446655440001'),

-- 饮食控制相关任务
('850e8400-e29b-41d4-a716-446655440009', 
 '制定饮食计划', 
 '制定科学的饮食计划，控制热量摄入', 
 'HIGH', 'COMPLETED', 
 '2024-01-08 20:00:00+08', 180, 
 ARRAY['饮食', '减重', '健康'], 
 '750e8400-e29b-41d4-a716-446655440004', 
 '550e8400-e29b-41d4-a716-446655440001'),

('850e8400-e29b-41d4-a716-446655440010', 
 '记录每日饮食', 
 '使用APP记录每日饮食摄入，监控热量', 
 'MEDIUM', 'IN_PROGRESS', 
 NULL, 15, 
 ARRAY['饮食记录', '热量控制'], 
 '750e8400-e29b-41d4-a716-446655440004', 
 '550e8400-e29b-41d4-a716-446655440001'),

-- TypeScript学习相关任务
('850e8400-e29b-41d4-a716-446655440011', 
 '学习泛型高级用法', 
 '深入学习TypeScript泛型的高级用法和约束', 
 'MEDIUM', 'IN_PROGRESS', 
 '2024-03-15 20:00:00+08', 240, 
 ARRAY['TypeScript', '泛型', '学习'], 
 '750e8400-e29b-41d4-a716-446655440006', 
 '550e8400-e29b-41d4-a716-446655440002'),

('850e8400-e29b-41d4-a716-446655440012', 
 '学习条件类型', 
 '掌握TypeScript条件类型的使用场景和技巧', 
 'MEDIUM', 'TODO', 
 '2024-03-25 20:00:00+08', 180, 
 ARRAY['TypeScript', '条件类型', '高级特性'], 
 '750e8400-e29b-41d4-a716-446655440006', 
 '550e8400-e29b-41d4-a716-446655440002'),

-- 财务管理相关任务
('850e8400-e29b-41d4-a716-446655440013', 
 '分析收支情况', 
 '详细分析过去一年的收入和支出情况', 
 'HIGH', 'COMPLETED', 
 '2024-01-30 20:00:00+08', 240, 
 ARRAY['财务分析', '收支管理'], 
 '750e8400-e29b-41d4-a716-446655440008', 
 '550e8400-e29b-41d4-a716-446655440003'),

('850e8400-e29b-41d4-a716-446655440014', 
 '开设投资账户', 
 '开设证券投资账户，开始投资理财', 
 'HIGH', 'IN_PROGRESS', 
 '2024-02-28 20:00:00+08', 120, 
 ARRAY['投资', '理财', '证券'], 
 '750e8400-e29b-41d4-a716-446655440009', 
 '550e8400-e29b-41d4-a716-446655440003');

-- 更新已完成任务的完成时间
UPDATE tasks SET 
    completed_at = '2024-01-24 16:30:00+08',
    actual_duration = 220
WHERE id = '850e8400-e29b-41d4-a716-446655440003';

UPDATE tasks SET 
    completed_at = '2024-01-19 18:45:00+08',
    actual_duration = 510
WHERE id = '850e8400-e29b-41d4-a716-446655440005';

UPDATE tasks SET 
    completed_at = '2024-01-05 19:30:00+08',
    actual_duration = 135
WHERE id = '850e8400-e29b-41d4-a716-446655440007';

UPDATE tasks SET 
    completed_at = '2024-01-08 21:15:00+08',
    actual_duration = 195
WHERE id = '850e8400-e29b-41d4-a716-446655440009';

UPDATE tasks SET 
    completed_at = '2024-01-29 22:00:00+08',
    actual_duration = 255
WHERE id = '850e8400-e29b-41d4-a716-446655440013';

-- 插入任务依赖关系
INSERT INTO task_dependencies (task_id, depends_on_task_id) VALUES
-- 集成测试依赖于单元测试完成
('850e8400-e29b-41d4-a716-446655440002', '850e8400-e29b-41d4-a716-446655440001'),
-- 基础组件实现依赖于架构设计完成
('850e8400-e29b-41d4-a716-446655440006', '850e8400-e29b-41d4-a716-446655440005'),
-- 每周跑步依赖于运动计划制定
('850e8400-e29b-41d4-a716-446655440008', '850e8400-e29b-41d4-a716-446655440007'),
-- 饮食记录依赖于饮食计划制定
('850e8400-e29b-41d4-a716-446655440010', '850e8400-e29b-41d4-a716-446655440009'),
-- 条件类型学习依赖于泛型学习
('850e8400-e29b-41d4-a716-446655440012', '850e8400-e29b-41d4-a716-446655440011'),
-- 投资账户开设依赖于收支分析完成
('850e8400-e29b-41d4-a716-446655440014', '850e8400-e29b-41d4-a716-446655440013');

-- 验证数据完整性的查询示例
-- 查看用户的目标和关键结果统计
SELECT 
    u.name as "用户",
    o.title as "目标",
    o.category as "分类",
    o.status as "状态",
    o.progress as "进度%",
    kr_stats.total_key_results as "关键结果数",
    kr_stats.completed_key_results as "已完成关键结果"
FROM users u
JOIN objectives o ON u.id = o.user_id
LEFT JOIN (
    SELECT 
        objective_id,
        COUNT(*) as total_key_results,
        COUNT(*) FILTER (WHERE status = 'COMPLETED') as completed_key_results
    FROM key_results
    GROUP BY objective_id
) kr_stats ON o.id = kr_stats.objective_id
ORDER BY u.name, o.created_at;

-- 查看任务完成情况
SELECT 
    u.name as "用户",
    o.title as "目标",
    kr.title as "关键结果",
    t.title as "任务",
    t.status as "状态",
    t.priority as "优先级",
    t.due_date as "截止时间"
FROM users u
JOIN tasks t ON u.id = t.user_id
JOIN key_results kr ON t.key_result_id = kr.id
JOIN objectives o ON kr.objective_id = o.id
ORDER BY u.name, o.title, kr.title, t.created_at; 