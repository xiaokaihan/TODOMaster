# TODOMaster Backend

TODOMaster åç«¯ API æœåŠ¡å™¨ï¼ŒåŸºäº Node.js + Express + TypeScript + PostgreSQL æ„å»ºã€‚

## ğŸ“š æ–‡æ¡£

- **[å®Œæ•´ API æ–‡æ¡£](./docs/API.md)** - è¯¦ç»†çš„æ¥å£è¯´æ˜å’Œç¤ºä¾‹
- **[OpenAPI è§„èŒƒ](./docs/openapi.yaml)** - æ ‡å‡† OpenAPI 3.0 è§„èŒƒ
- **[æ–‡æ¡£ä¸­å¿ƒ](./docs/README.md)** - æ–‡æ¡£å¯¼èˆªå’Œå·¥å…·é›†æˆ
- **[æµ‹è¯•æŒ‡å—](./TESTING.md)** - API æµ‹è¯•è¯´æ˜

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

ç¡®ä¿ä½ åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œè¿‡ `yarn install`ï¼Œè¿™ä¼šå®‰è£…æ‰€æœ‰å¿…è¦çš„ä¾èµ–ã€‚

### 2. ç¯å¢ƒå˜é‡é…ç½®

åœ¨ `packages/backend` ç›®å½•ä¸‹åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# åº”ç”¨é…ç½®
NODE_ENV=development
PORT=3000
API_PREFIX=/api/v1

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=5432
DB_NAME=todomaster
DB_USERNAME=admin
DB_PASSWORD=123456
DB_SSL=false
DB_MAX_CONNECTIONS=20
DB_IDLE_TIMEOUT=30000
DB_CONNECTION_TIMEOUT=5000

# JWT é…ç½®
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_EXPIRES_IN=7d
JWT_REFRESH_SECRET=your-super-secret-refresh-key-change-this-in-production
JWT_REFRESH_EXPIRES_IN=30d

# BCrypt é…ç½®
BCRYPT_SALT_ROUNDS=12

# CORS é…ç½®
CORS_ORIGIN=http://localhost:5173

# é€Ÿç‡é™åˆ¶é…ç½®
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# æ—¥å¿—é…ç½®
LOG_LEVEL=info
```

### 3. æ•°æ®åº“è®¾ç½®

ç¡®ä¿ä½ çš„ PostgreSQL æ•°æ®åº“æ­£åœ¨è¿è¡Œï¼Œç„¶åï¼š

```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
yarn db:test

# è¿è¡Œæ•°æ®åº“è¿ç§»
yarn db:migrate

# æ£€æŸ¥è¿ç§»çŠ¶æ€
yarn db:status
```

### 4. å¯åŠ¨æœåŠ¡å™¨

```bash
# å¼€å‘æ¨¡å¼
yarn dev

# ç”Ÿäº§æ¨¡å¼
yarn build
yarn start
```

## ğŸ“‹ å¯ç”¨è„šæœ¬

### å¼€å‘è„šæœ¬
- `yarn dev` - å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆä½¿ç”¨ ts-nodeï¼‰
- `yarn build` - æ„å»ºç”Ÿäº§ç‰ˆæœ¬
- `yarn start` - å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
- `yarn lint` - è¿è¡Œ ESLint æ£€æŸ¥
- `yarn test` - è¿è¡Œæµ‹è¯•
- `yarn test:watch` - ä»¥ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•

### æ•°æ®åº“è„šæœ¬
- `yarn db:test` - æµ‹è¯•æ•°æ®åº“è¿æ¥
- `yarn db:migrate` - è¿è¡Œæ•°æ®åº“è¿ç§»
- `yarn db:status` - æ£€æŸ¥è¿ç§»çŠ¶æ€
- `yarn db:stats` - æ˜¾ç¤ºæ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯
- `yarn db:reset` - é‡ç½®æ•°æ®åº“ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰
- `yarn db:rebuild` - é‡å»ºæ•°æ®åº“ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰
- `yarn db:help` - æ˜¾ç¤ºæ•°æ®åº“ç®¡ç†å·¥å…·å¸®åŠ©

## ğŸ—„ï¸ æ•°æ®åº“æ¶æ„

### æ ¸å¿ƒè¡¨ç»“æ„

1. **users** - ç”¨æˆ·è¡¨
   - æ”¯æŒé‚®ç®±ç™»å½•
   - å¯†ç åŠ å¯†å­˜å‚¨
   - è§’è‰²ç®¡ç†ï¼ˆuser/adminï¼‰

2. **objectives** - ç›®æ ‡è¡¨
   - æ”¯æŒåˆ†ç±»ï¼ˆå·¥ä½œã€ä¸ªäººã€å¥åº·ç­‰ï¼‰
   - è¿›åº¦è¿½è¸ª
   - å¼€å§‹/ç»“æŸæ—¥æœŸ

3. **key_results** - å…³é”®ç»“æœè¡¨
   - æ”¯æŒæ•°å€¼ã€ç™¾åˆ†æ¯”ã€å¸ƒå°”ç±»å‹
   - è‡ªåŠ¨è¿›åº¦è®¡ç®—
   - ä¸ç›®æ ‡å…³è”

4. **tasks** - ä»»åŠ¡è¡¨
   - ä¼˜å…ˆçº§ç®¡ç†
   - æˆªæ­¢æ—¥æœŸ
   - ä¸ç›®æ ‡å’Œå…³é”®ç»“æœå…³è”
   - æ—¶é—´é¢„ä¼°å’Œå®é™…ç”¨æ—¶

5. **task_dependencies** - ä»»åŠ¡ä¾èµ–å…³ç³»
6. **task_tags** - ä»»åŠ¡æ ‡ç­¾ç³»ç»Ÿ
7. **activity_logs** - æ´»åŠ¨æ—¥å¿—

### æ•°æ®åº“ç‰¹æ€§

- **è‡ªåŠ¨è¿›åº¦è®¡ç®—**ï¼šå…³é”®ç»“æœå’Œç›®æ ‡è¿›åº¦è‡ªåŠ¨è®¡ç®—
- **è§¦å‘å™¨æ”¯æŒ**ï¼šè‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³å’Œè¿›åº¦
- **æ•°æ®å®Œæ•´æ€§**ï¼šå¤–é”®çº¦æŸå’Œæ£€æŸ¥çº¦æŸ
- **ç´¢å¼•ä¼˜åŒ–**ï¼šæŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
- **è½¯åˆ é™¤**ï¼šç”¨æˆ·ç¦ç”¨è€Œéåˆ é™¤

## ğŸ”Œ API ç«¯ç‚¹

### è®¤è¯ç›¸å…³
- `POST /api/v1/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/v1/auth/login` - ç”¨æˆ·ç™»å½•
- `POST /api/v1/auth/refresh` - åˆ·æ–°ä»¤ç‰Œ
- `GET /api/v1/auth/me` - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- `PUT /api/v1/auth/me` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- `PUT /api/v1/auth/password` - ä¿®æ”¹å¯†ç 
- `POST /api/v1/auth/logout` - ç™»å‡º

### ç›®æ ‡ç®¡ç†
- `GET /api/v1/objectives` - è·å–ç›®æ ‡åˆ—è¡¨
- `POST /api/v1/objectives` - åˆ›å»ºç›®æ ‡
- `GET /api/v1/objectives/:id` - è·å–å•ä¸ªç›®æ ‡
- `PUT /api/v1/objectives/:id` - æ›´æ–°ç›®æ ‡
- `DELETE /api/v1/objectives/:id` - åˆ é™¤ç›®æ ‡

### å…³é”®ç»“æœ
- `GET /api/v1/key-results` - è·å–å…³é”®ç»“æœåˆ—è¡¨
- `POST /api/v1/key-results` - åˆ›å»ºå…³é”®ç»“æœ
- `PUT /api/v1/key-results/:id` - æ›´æ–°å…³é”®ç»“æœ
- `DELETE /api/v1/key-results/:id` - åˆ é™¤å…³é”®ç»“æœ

### ä»»åŠ¡ç®¡ç†
- `GET /api/v1/tasks` - è·å–ä»»åŠ¡åˆ—è¡¨
- `POST /api/v1/tasks` - åˆ›å»ºä»»åŠ¡
- `PUT /api/v1/tasks/:id` - æ›´æ–°ä»»åŠ¡
- `DELETE /api/v1/tasks/:id` - åˆ é™¤ä»»åŠ¡

### ç»Ÿè®¡ä¿¡æ¯
- `GET /api/v1/stats/overview` - è·å–æ€»ä½“ç»Ÿè®¡
- `GET /api/v1/stats/progress-trend` - è·å–è¿›åº¦è¶‹åŠ¿

### ç”¨æˆ·ç®¡ç†ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
- `GET /api/v1/users` - è·å–ç”¨æˆ·åˆ—è¡¨
- `GET /api/v1/users/:id` - è·å–å•ä¸ªç”¨æˆ·
- `PUT /api/v1/users/:id` - æ›´æ–°ç”¨æˆ·
- `DELETE /api/v1/users/:id` - åˆ é™¤ç”¨æˆ·
- `GET /api/v1/users/stats/overview` - è·å–ç”¨æˆ·ç»Ÿè®¡

## ğŸ”’ è®¤è¯å’Œæƒé™

- **JWT ä»¤ç‰Œè®¤è¯**ï¼šè®¿é—®ä»¤ç‰Œ + åˆ·æ–°ä»¤ç‰Œæœºåˆ¶
- **è§’è‰²æƒé™**ï¼šæ”¯æŒç”¨æˆ·å’Œç®¡ç†å‘˜è§’è‰²
- **èµ„æºæƒé™**ï¼šç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- **é€Ÿç‡é™åˆ¶**ï¼šé˜²æ­¢ API æ»¥ç”¨

## ğŸ› ï¸ å¼€å‘å·¥å…·

### æ•°æ®åº“ç®¡ç†
ä½¿ç”¨å†…ç½®çš„æ•°æ®åº“ CLI å·¥å…·ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
yarn db:help

# æµ‹è¯•è¿æ¥
yarn db:test

# æŸ¥çœ‹è¿ç§»çŠ¶æ€
yarn db:status

# æŸ¥çœ‹æ•°æ®åº“ç»Ÿè®¡
yarn db:stats
```

### æ—¥å¿—ç³»ç»Ÿ
- ç»“æ„åŒ–æ—¥å¿—è¾“å‡º
- ä¸åŒæ—¥å¿—çº§åˆ«ï¼ˆerror, warn, info, debugï¼‰
- è¯·æ±‚/å“åº”æ—¥å¿—
- æ•°æ®åº“æ“ä½œæ—¥å¿—
- è®¤è¯æ“ä½œæ—¥å¿—

### é”™è¯¯å¤„ç†
- å…¨å±€é”™è¯¯å¤„ç†ä¸­é—´ä»¶
- è‡ªå®šä¹‰é”™è¯¯ç±»
- è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- ç”¨æˆ·å‹å¥½é”™è¯¯æ¶ˆæ¯

## ğŸš€ éƒ¨ç½²

### ç”Ÿäº§ç¯å¢ƒé…ç½®

1. è®¾ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
2. ä½¿ç”¨å¼ºå¯†ç å’Œå¯†é’¥
3. å¯ç”¨ SSL
4. é…ç½®åå‘ä»£ç†
5. è®¾ç½®ç›‘æ§å’Œæ—¥å¿—

### Docker æ”¯æŒ

é¡¹ç›®æ ¹ç›®å½•åŒ…å« Docker é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒå®¹å™¨åŒ–éƒ¨ç½²ã€‚

## ğŸ¤ è´¡çŒ®

è¯·æŸ¥çœ‹é¡¹ç›®æ ¹ç›®å½•çš„ CONTRIBUTING.md æ–‡ä»¶äº†è§£è´¡çŒ®æŒ‡å—ã€‚

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ LICENSE æ–‡ä»¶ã€‚ 